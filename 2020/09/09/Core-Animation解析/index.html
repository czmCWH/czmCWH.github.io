<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Core Animation解析"><meta name="keywords" content="iOS,Core Animation"><meta name="author" content="Czm"><meta name="copyright" content="Czm"><title>Core Animation解析 | Czm</title><link rel="shortcut icon" href="/img/my-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Core-Animation解析"><span class="toc-number">1.</span> <span class="toc-text">Core Animation解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CAAnimation"><span class="toc-number">2.</span> <span class="toc-text">CAAnimation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#隐式动画和显式动画"><span class="toc-number">2.1.</span> <span class="toc-text">隐式动画和显式动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CABasicAnimation基本动画"><span class="toc-number">2.2.</span> <span class="toc-text">CABasicAnimation基本动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAKeyframeAnimation关键帧动画"><span class="toc-number">2.3.</span> <span class="toc-text">CAKeyframeAnimation关键帧动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CASpringAnimation弹簧动画"><span class="toc-number">2.4.</span> <span class="toc-text">CASpringAnimation弹簧动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAAnimationGroup动画组"><span class="toc-number">2.5.</span> <span class="toc-text">CAAnimationGroup动画组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CATransition过渡动画"><span class="toc-number">2.6.</span> <span class="toc-text">CATransition过渡动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAMediaTiming"><span class="toc-number">2.7.</span> <span class="toc-text">CAMediaTiming</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#层级关系时间"><span class="toc-number">2.7.1.</span> <span class="toc-text">层级关系时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子：动画的暂停、恢复、取消"><span class="toc-number">2.7.2.</span> <span class="toc-text">例子：动画的暂停、恢复、取消</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子：控制动画时间"><span class="toc-number">2.7.3.</span> <span class="toc-text">例子：控制动画时间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CATransaction-事务"><span class="toc-number">2.8.</span> <span class="toc-text">CATransaction(事务)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#暂时禁用图层的行为"><span class="toc-number">2.8.1.</span> <span class="toc-text">暂时禁用图层的行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重载隐式动画的时间"><span class="toc-number">2.8.2.</span> <span class="toc-text">重载隐式动画的时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#嵌套显式事务"><span class="toc-number">2.8.3.</span> <span class="toc-text">嵌套显式事务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#同时设置UIView和CALayer更改的动画"><span class="toc-number">2.9.</span> <span class="toc-text">同时设置UIView和CALayer更改的动画</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#学习博客"><span class="toc-number">3.</span> <span class="toc-text">学习博客</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="img/avatar.jpeg"></div><div class="author-info__name text-center">Czm</div><div class="author-info__description text-center">学习记录</div><div class="follow-button"><a href="https://github.com/czmCWH" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">33</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">7</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">10</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://www.cnswift.org/about-swift" target="_blank" rel="noopener">swift中文文档</a><a class="author-info-links__name text-center" href="https://swift.gg" target="_blank" rel="noopener">SwiftGG</a><a class="author-info-links__name text-center" href="http://chuangzaoshi.com" target="_blank" rel="noopener">创造狮导航</a><a class="author-info-links__name text-center" href="http://lib.xcz.im/library" target="_blank" rel="noopener">《西窗烛》</a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Czm</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/About">关于</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Core Animation解析</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-09-09</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/iOS/">iOS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/iOS/Graphics-Animation/">Graphics &amp; Animation</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="Core-Animation解析"><a href="#Core-Animation解析" class="headerlink" title="Core Animation解析"></a>Core Animation解析</h2><p><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514" target="_blank" rel="noopener">Core Animation</a> 是 <code>iOS</code> 和 <code>macOS</code> 上用于 图形渲染 和 动画 基础库，<code>Core Animation</code> 位于 <code>AppKit</code> 和 <code>UIKit</code> 之下，并紧密集成到<code>Cocoa</code> 和 <code>Cocoa Touch</code> 的 视图 工作流程中。</p>
<a id="more"></a>

<p><code>Core Animation</code> 会将大部分实际绘图工作交给图形硬件(<code>Graphics hardware</code>)来加速渲染。这种自动化的图形加速的结果是让动画拥有更高的帧率并且显示效果更加平滑，而不会加重CPU负担而影响App的运行速度。</p>
<p>一般开发中不需要与用户交互的用 <code>Core Animation</code>，如转场动画。其它用 <code>UIView</code> 的动画。</p>
<img src="/2020/09/09/Core-Animation%E8%A7%A3%E6%9E%90/15964201466043.jpg" class="" title="This is an example image">


<p>1、<code>Core Animation</code>管理APP显示的内容<br><code>Core Animation</code> 并不是一个绘图系统。它是用于在硬件中合成和处理应用程序内容的基础库，这个基础库的核心是 <code>CALayer</code>，可以使用 <code>CALayer</code> 实例来管理和操作内容。<code>CALayer</code>实例将内容捕获到位图中，图形硬件(<code>Graphics hardware</code>)可以很容易的操作位图。</p>
<p>2、修改图层会触发动画<br>使用 <code>Core Animation</code> 创建的大多数动画都涉及对 <code>CALayer</code> 属性的修改。改变 <code>CALayer</code> 的可动画属性会导致创建 隐式动画 ，从而使图层从旧值动画到新值。如果想更好地控制生成的动画行为，还可以 显式设置这些属性的动画。</p>
<p>3、图层树<br>可以按层次排列 <code>CALayer</code> 以创建父子关系，层的排列以类似于视图的方式影响它们管理的视觉内容，以将应用程序的视觉内容扩展到视图之外。</p>
<p>4、更改 <code>CALayer</code> 的默认行为<br>隐式动画是使用 <code>action</code> 对象实现的，<code>action</code> 对象是实现预定义接口的通用对象。<code>Core Animation</code> 使用 <code>action</code> 对象来实现通常与层关联的默认动画。您可以创建自己的动作对象来实现自定义动画，也可以使用它们来实现其他类型的行为。然后将动作对象分配给该层的一个属性。当那个属性改变时，<code>Core Animation</code> 会检索你的动作对象并告诉它执行它的动作。</p>
<h2 id="CAAnimation"><a href="#CAAnimation" class="headerlink" title="CAAnimation"></a>CAAnimation</h2><p><code>CAAnimation</code> 是所有动画子类的抽象类。<code>CAAnimation</code> 采用 <code>CAMediaTiming</code> 协议为动画提供简单持续时间、速度和重复计数。<code>CAAnimation</code> 还采用了 <code>CAAction</code> 协议，为图层触发一个动画动作提供 了标准化响应。<code>CAAnimation</code> 定义了一个使用贝塞尔曲线来描述动画改变的时间函数。</p>
<img src="/2020/09/09/Core-Animation%E8%A7%A3%E6%9E%90/15973822875492.jpg" class="" title="This is an example image">


<ul>
<li>时间曲线函数</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 时间曲线函数：将动画的速度描述为一个简单的贝塞尔曲线。</span></span><br><span class="line"><span class="comment"> * 当前提供的值有：</span></span><br><span class="line"><span class="comment"> * .linear：均匀线性</span></span><br><span class="line"><span class="comment"> * .easeIn：缓入。先缓慢，后加速</span></span><br><span class="line"><span class="comment"> * .easeOut：缓出。先快速，后减速</span></span><br><span class="line"><span class="comment"> * .easeInEaseOut：缓入缓出。先缓慢，中间加速，后减速</span></span><br><span class="line"><span class="comment"> * .default：隐式动画使用的曲线</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">let</span> timing = <span class="type">CAMediaTimingFunction</span>(name: .linear)</span><br><span class="line"><span class="keyword">let</span> anim = <span class="type">CAAnimation</span>()</span><br><span class="line"><span class="comment">// 定义动画速度(节奏、步调)的时间函数。默认值为nil，表示线性速度，动画在持续时间内持续均匀发生</span></span><br><span class="line">anim.timingFunction = timing</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* 自定义时间曲线的函数</span></span><br><span class="line"><span class="comment"> * c1x，c1y代表贝塞尔曲线的第一个点；c2x，c2y代表贝塞尔曲线的第二个点；</span></span><br><span class="line"><span class="comment"> * 它们的取值范围都是 0~1</span></span><br><span class="line"><span class="comment"> * 具体取值，可以参考 贝塞尔曲线绘制的网站：https://cubic-bezier.com/#.17,.67,.83,.67 或者 http://www.roblaplaca.com/examples/bezierBuilder/</span></span><br><span class="line"><span class="comment"> * https://github.com/keefo/CATweaker 这个xcode插件比较老了</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//let onetiming = CAMediaTimingFunction(controlPoints: Float, c1y, c2x, c2y)</span></span><br></pre></td></tr></table></figure>

<h3 id="隐式动画和显式动画"><a href="#隐式动画和显式动画" class="headerlink" title="隐式动画和显式动画"></a>隐式动画和显式动画</h3><p>隐式动画：修改CALayer的动画属性时，它是从先前的值平滑过渡到新的值，会触发隐式动画，Core Animation 会使用默认的时间和动画属性来执行动画。</p>
<p>显式动画：创建动画对象，并配置动画参数，把该动画对象添加到图层上执行。</p>
<p>需要注意的是：显式动画仅生成动画，不会修改图层树中的数据。在动画结束时，Core Animation会从图层中删除动画对象，并使用其当前数据值重画该图层。如果需要保持动画后的值，需要我们手动设置图层的属性。</p>
<h3 id="CABasicAnimation基本动画"><a href="#CABasicAnimation基本动画" class="headerlink" title="CABasicAnimation基本动画"></a>CABasicAnimation基本动画</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CABasicAnimation</span> : <span class="title">CAPropertyAnimation</span></span></span><br></pre></td></tr></table></figure>

<p>CABasicAnimation 用于对 CALayer 的<a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/AnimatableProperties/AnimatableProperties.html#//apple_ref/doc/uid/TP40004514-CH11-SW1" target="_blank" rel="noopener">Animatable Properties</a>从开始值更改为结束值，提供基本动画。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据动画属性创建一个动画对象</span></span><br><span class="line"><span class="keyword">let</span> anim = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"opacity"</span>)</span><br><span class="line"><span class="comment">// 如果未设置该值，则使用当前值</span></span><br><span class="line">anim.fromValue = <span class="number">1</span></span><br><span class="line">anim.toValue = <span class="number">0</span></span><br><span class="line"><span class="comment">// 动画持续时间，默认值0.25</span></span><br><span class="line">anim.duration = <span class="number">3</span></span><br><span class="line"><span class="comment">// 动画重复的次数，无限循环 MAXFLOAT</span></span><br><span class="line">anim.repeatCount = <span class="number">1</span></span><br><span class="line"><span class="comment">// 动画完成后，动画对象是否从CALayer中移除。默认为 true 移除，动画属性会恢复到动画前的状态</span></span><br><span class="line">anim.isRemovedOnCompletion = <span class="literal">false</span></span><br><span class="line"><span class="comment">// 通过代理监听动画的开始和结束</span></span><br><span class="line">anim.delegate = <span class="keyword">self</span></span><br><span class="line"><span class="comment">/*把动画添加到图层，使用唯一的key来标识该动画。</span></span><br><span class="line"><span class="comment">  添加的该动画对象，是进行了复制，而不是引用。因此不能引用该动画对象，作后续的修改。可以通过其 key 来获取该动画对象，调用CALayer的 .animation(forKey:方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">redLayer.add(anim, forKey: <span class="string">"key_opacity"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// CAAnimationDelegate，通过代理在动画结束后，更新动画属性的值。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">animationDidStop</span><span class="params">(<span class="number">_</span> anim: CAAnimation, finished flag: Bool)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 显式动画只进行动画，不会修改属性的值。因此需要在动画结束时，更新动画属性。</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> opacityAnim = redLayer.animation(forKey: <span class="string">"key_opacity"</span>), opacityAnim === anim &#123;</span><br><span class="line">        <span class="type">CATransaction</span>.begin()</span><br><span class="line">        <span class="type">CATransaction</span>.setDisableActions(<span class="literal">true</span>)</span><br><span class="line">        redLayer.opacity = (anim <span class="keyword">as</span>! <span class="type">CABasicAnimation</span>).toValue <span class="keyword">as</span>! <span class="type">Float</span></span><br><span class="line">        <span class="type">CATransaction</span>.commit()</span><br><span class="line">        <span class="comment">// 根据需要是否移除动画对象</span></span><br><span class="line"><span class="comment">//            redLayer.removeAnimation(forKey: "opacity")</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回[String]，添加到图层的动画key(动画方式)</span></span><br><span class="line"><span class="keyword">let</span> keys = redLayer.animationKeys()</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 根据 动画的key，获取被添加的动画对象</span></span><br><span class="line"><span class="keyword">let</span> anim = redLayer.animation(forKey: keys?.first ?? <span class="string">""</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 根据 动画的key，删除动画对象</span></span><br><span class="line">redLayer.removeAnimation(forKey: keys?.first ?? <span class="string">""</span>)</span><br></pre></td></tr></table></figure>

<p>fillMode（填充模式）</p>
<ul>
<li>对于设置了 beginTime 延迟时间的动画，当动画对象被添加到layer时，动画处于开始等待，这时，动画开始之前其动画属性的值是什么？</li>
<li>对于设置了 anim.isRemovedOnCompletion = false，动画对象在动画结束后不被移除，这时，动画结束后其动画属性的值是什么？</li>
</ul>
<p>如下例子，position.y 的值，在动画开始之前可能为：未添加动画前的值 or fromValue；动画结束后可能为：toValue<br>     这就需要：fillMode填充模式来控制</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anim = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"position.y"</span>)</span><br><span class="line">    </span><br><span class="line">anim.fromValue = <span class="number">300</span></span><br><span class="line">anim.toValue = <span class="number">500</span></span><br><span class="line"><span class="comment">// 动画延迟3秒执行</span></span><br><span class="line">anim.beginTime = <span class="type">CACurrentMediaTime</span>() + <span class="number">3</span></span><br><span class="line">anim.duration = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 填充模式，决定动画属性的值，在动画之前(beginTime不等于0)或动画之后的值。</span></span><br><span class="line"><span class="comment"> forwards: 动画开始前，保持未添加动画前的值；动画结束后，layer会一直保持着动画最后的状态。</span></span><br><span class="line"><span class="comment"> backwards: 动画开始前，保持值为 fromValue；动画结束后，保持值为未添加动画的值</span></span><br><span class="line"><span class="comment"> both: 动画开始前保持 fromValue，动画结束时保持toValue</span></span><br><span class="line"><span class="comment"> removed: 动画开始和结束，都不受动画的影响</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> 注意：forwards 和 both 必须在 isRemovedOnCompletion = false 生效。因为显式动画结束后，动画对象移除，动画属性复原。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">anim.fillMode = <span class="type">CAMediaTimingFillMode</span>.both</span><br><span class="line">anim.isRemovedOnCompletion = <span class="literal">false</span></span><br><span class="line">redLayer.add(anim, forKey: <span class="string">"position.y"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 根据需要，在合适的时候把动画属性设置为动画后的值，并移除动画对象。</span></span><br><span class="line"><span class="comment">//        redLayer.position.y = 500</span></span><br><span class="line"><span class="comment">//        redLayer.removeAnimation(forKey: "position.y")</span></span><br></pre></td></tr></table></figure>

<p>在使用CALayer动画时，动画结束后如何更新动画属性？上面的例子中给出了两种做法：</p>
<ul>
<li><p>方式一：是代理中回调更新动画属性。<br>这种方式的弊端是，当有多个动画的代理对象相同时，那么添加动画时要保证动画key不同，并且动画结束后，要做一些判断才能更新动画属性的值，这样做比较麻烦，建议使用方式二。</p>
</li>
<li><p>方式二：通过设置动画对象的属性 <code>.fillMode</code> 和 <code>.isRemovedOnCompletion</code> 来控制。</p>
</li>
</ul>
<h3 id="CAKeyframeAnimation关键帧动画"><a href="#CAKeyframeAnimation关键帧动画" class="headerlink" title="CAKeyframeAnimation关键帧动画"></a>CAKeyframeAnimation关键帧动画</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CAKeyframeAnimation</span> : <span class="title">CAPropertyAnimation</span></span></span><br></pre></td></tr></table></figure>
<p>CAKeyframeAnimation 和 CABasicAnimation 都是 CAPropertyAnimation 的子类，它依然是对CALayer的单一属性进行动画，其不同之处在于，可以设置一连串随意的值 和 时间 来做动画。</p>
<ul>
<li>关键帧：指的是动画过程中特定时间点的某一帧，使用 CAKeyframeAnimation 动画时我们提供了显著的帧。关键帧之间值的插值，<code>Core Animation</code>在每帧之间进行插入。在动画期间，Core Animation通过在您提供的值之间插值来生成中间值。</li>
</ul>
<p>使用 CAKeyframeAnimation 进行动画有2种方式：</p>
<ul>
<li>大多数类型的属性动画，只需要设置 <code>values</code> 和 <code>keyTimes</code> 来确定关键帧的值。然后 <code>Core Animation</code> 根据关键帧之间来生成插值来进行过渡动画。</li>
<li>当设置坐标动画时，需要设置 <code>path</code> 属性的路径，而不是单个的值。</li>
</ul>
<p>1、对 CALayer 的背景色进行关键帧动画<br>可以看到 CAKeyframeAnimation 不会把初始值作为第一帧，而是突然恢复到原始的值。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据动画属性创建动画对象</span></span><br><span class="line"><span class="keyword">let</span> anim = <span class="type">CAKeyframeAnimation</span>(keyPath: <span class="string">"backgroundColor"</span>)</span><br><span class="line">anim.duration = <span class="number">9</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">/* 一个数组，其元素用于动画的关键帧值，动画对象在相应的时间内依次显示关键值。当动画对象 path = nil 时，才使用values。</span></span><br><span class="line"><span class="comment"> * 每个值作用的时间由动画计时器决定，动画计时器由：calculationMode、keyTimes、timingFunctions 来决定</span></span><br><span class="line"><span class="comment"> * 关键帧之间值的插值，Core Animation在每帧之间进行插入。当 calculationMode = .discrete 时，不提供插值。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">anim.values = [<span class="type">UIColor</span>.green.cgColor,</span><br><span class="line">               <span class="type">UIColor</span>.yellow.cgColor,</span><br><span class="line">               <span class="type">UIColor</span>.blue.cgColor]</span><br><span class="line">    </span><br><span class="line"><span class="comment">/* 用于定义应用给定关键帧段的时间，每个时间点表示关键帧值的时间点。当未设置该值时，表示每个关键帧的时间平分。</span></span><br><span class="line"><span class="comment"> * 该数组元素的取值范围为 0.0~1.0，连续的元素必须大于或等于上一个元素。</span></span><br><span class="line"><span class="comment"> * 时间点的个数与 values的元素数 或者 path的控制点数 相等。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">anim.keyTimes = [<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 定义每个关键帧段的动画时间曲线，其数组的元素个数 等于 关键帧数 - 1。</span></span><br><span class="line">anim.timingFunctions = [.<span class="keyword">init</span>(name: .easeIn), .<span class="keyword">init</span>(name: .easeOut)]</span><br><span class="line">    </span><br><span class="line"><span class="comment">/* 指定接收器如何计算关键帧之间的插值</span></span><br><span class="line"><span class="comment"> * .cubic 平滑线性计算</span></span><br><span class="line"><span class="comment"> * .cubicPaced</span></span><br><span class="line"><span class="comment"> * .discrete 依次使用每个关键帧值，不计算插值</span></span><br><span class="line"><span class="comment"> * .linear 默认值，关键帧值之间线性计算</span></span><br><span class="line"><span class="comment"> * .paced</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">anim.calculationMode = .cubicPaced</span><br><span class="line">redLayer.add(anim, forKey: <span class="string">"key_backgroundColor"</span>)</span><br></pre></td></tr></table></figure>

<p>2、使用UIBezierPath绘制动画运动的路径</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="type">UIBezierPath</span>(ovalIn: <span class="type">CGRect</span>(x: redLayer.position.x, y: redLayer.position.y, width: <span class="number">200</span>, height: <span class="number">200</span>))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> anim = <span class="type">CAKeyframeAnimation</span>(keyPath: <span class="string">"position"</span>)</span><br><span class="line"><span class="comment">// 如果设置 path 有值，则不使用 values 中的值来动画</span></span><br><span class="line">anim.path = path.cgPath</span><br><span class="line">anim.duration = <span class="number">10</span></span><br><span class="line">anim.timingFunctions = [.<span class="keyword">init</span>(name: .linear), .<span class="keyword">init</span>(name: .easeIn), .<span class="keyword">init</span>(name: .easeOut), .<span class="keyword">init</span>(name: .easeInEaseOut)]</span><br><span class="line">anim.fillMode = .both</span><br><span class="line">anim.isRemovedOnCompletion = <span class="literal">false</span></span><br><span class="line">redLayer.add(anim, forKey: <span class="string">"key_position"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="CASpringAnimation弹簧动画"><a href="#CASpringAnimation弹簧动画" class="headerlink" title="CASpringAnimation弹簧动画"></a>CASpringAnimation弹簧动画</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">9.0</span>, *)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CASpringAnimation</span> : <span class="title">CABasicAnimation</span></span></span><br></pre></td></tr></table></figure>
<p>CASpringAnimation 是 CABasicAnimation 的子类，通常使用它来设置 position 的动画。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 阻尼系数，默认值为10。用来阻止弹簧拉伸。增大其值，摆动会减少，沉降持续时间可能会小于持续时间</span></span><br><span class="line">anim.damping = <span class="number">20.0</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 初始速度，默认值为0. 负值表示对象远离弹簧附着点，正值表示对象向弹簧附着点移动。</span></span><br><span class="line">anim.initialVelocity = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 质量，默认值为1。值越大，弹簧会受到更多次的摆动，拉伸幅度也越大</span></span><br><span class="line">anim.mass = <span class="number">10</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 弹性系数，默认值100。其值越大，摆动次数越少，持续时间越短</span></span><br><span class="line">anim.stiffness = <span class="number">10</span></span><br><span class="line">    </span><br><span class="line">redLayer.add(anim, forKey: <span class="string">"key_position.y"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">//估算时间 返回弹簧动画到停止时的估算时间，根据当前的动画参数估算</span></span><br><span class="line"><span class="built_in">print</span>(anim.settlingDuration)</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anim = <span class="type">CASpringAnimation</span>(keyPath: <span class="string">"position.y"</span>)</span><br><span class="line">anim.beginTime = <span class="type">CACurrentMediaTime</span>() + <span class="number">1</span></span><br><span class="line">anim.duration = <span class="number">3</span></span><br><span class="line">anim.fromValue = redLayer.position.y - <span class="number">50</span></span><br><span class="line">anim.toValue = redLayer.position.y + <span class="number">300</span></span><br><span class="line">    </span><br><span class="line">anim.initialVelocity = <span class="number">20</span></span><br><span class="line">anim.damping = <span class="number">40</span></span><br><span class="line">anim.stiffness = <span class="number">100</span></span><br><span class="line">    </span><br><span class="line">redLayer.add(anim, forKey: <span class="string">"key_position.y"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="CAAnimationGroup动画组"><a href="#CAAnimationGroup动画组" class="headerlink" title="CAAnimationGroup动画组"></a>CAAnimationGroup动画组</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CAAnimationGroup</span> : <span class="title">CAAnimation</span></span></span><br></pre></td></tr></table></figure>

<p>CABasicAnimation、CASpringAnimation、CAKeyframeAnimation都是单一的对CALayer的动画属性进行动画，CAAnimationGroup用于把多个动画组合起来同事运行。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anim = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"opacity"</span>)</span><br><span class="line">anim.fromValue = <span class="number">0</span></span><br><span class="line">anim.toValue = <span class="number">1</span></span><br><span class="line">anim.duration = <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> scaleAnim = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"transform.scale"</span>)</span><br><span class="line">scaleAnim.fromValue = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">scaleAnim.toValue = [<span class="number">1.5</span>, <span class="number">1.5</span>, <span class="number">0</span>]</span><br><span class="line">scaleAnim.duration = <span class="number">4</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> path = <span class="type">UIBezierPath</span>(ovalIn: <span class="type">CGRect</span>(x: redLayer.position.x, y: redLayer.position.y, width: <span class="number">200</span>, height: <span class="number">200</span>))</span><br><span class="line"><span class="keyword">let</span> keyAnim = <span class="type">CAKeyframeAnimation</span>(keyPath: <span class="string">"position"</span>)</span><br><span class="line">keyAnim.path = path.cgPath</span><br><span class="line">keyAnim.duration = <span class="number">8</span></span><br><span class="line">keyAnim.timingFunctions = [.<span class="keyword">init</span>(name: .linear), .<span class="keyword">init</span>(name: .easeIn), .<span class="keyword">init</span>(name: .easeOut), .<span class="keyword">init</span>(name: .easeInEaseOut)]</span><br><span class="line">keyAnim.fillMode = .both</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> group = <span class="type">CAAnimationGroup</span>()</span><br><span class="line">group.animations = [anim, scaleAnim, keyAnim]</span><br><span class="line">group.duration = <span class="number">8</span></span><br><span class="line">group.isRemovedOnCompletion = <span class="literal">false</span></span><br><span class="line">group.fillMode = .both</span><br><span class="line">redLayer.add(group, forKey: <span class="string">"key_group"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="CATransition过渡动画"><a href="#CATransition过渡动画" class="headerlink" title="CATransition过渡动画"></a>CATransition过渡动画</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">2.0</span>, *)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CATransition</span> : <span class="title">CAAnimation</span></span></span><br></pre></td></tr></table></figure>
<p><code>CAPropertyAnimation</code> 只对 CALayer 的可动画属性起作用，如果要改变一个不能动画的属性(例如：图片切换，更改图层的层级关系等)，这就需要用到 <code>CATransition</code> 。</p>
<p><code>CATransition</code>并不能对动画属性的两个值之间做动画，它为图层提供变化时的过渡效果，从原本外观交换过渡到一个新的外观，能影响图层的整个内容。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anim = <span class="type">CATransition</span>()</span><br><span class="line">anim.duration = <span class="number">6</span></span><br><span class="line"><span class="comment">// 过渡开始的进度值，取值0.0~1.0。</span></span><br><span class="line">anim.startProgress = <span class="number">0.0</span></span><br><span class="line"><span class="comment">// 过渡终点，其值大于startProgress，但不大于1.0</span></span><br><span class="line">anim.endProgress = <span class="number">1.0</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">/* 变换效果</span></span><br><span class="line"><span class="comment"> * CATransitionType类型值有这么几种：.fade(淡入淡出)、.moveIn(滑入)、.push(滑出)、.reveal(揭开)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * CATransitionType(rawValue: "")方式，私有API还有这样几种：</span></span><br><span class="line"><span class="comment"> * cube(立方体翻滚)、oglFlip(上下左右翻转)、suckEffect(如一块布被抽走)、rippleEffect(水滴)、</span></span><br><span class="line"><span class="comment"> * pageCurl(向上翻页)、pageUnCurl(向下翻页)、cameraIrisHollowOpen(镜头打开)、cameraIrisHollowClose(相机镜头关闭)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">anim.type = <span class="type">CATransitionType</span>.moveIn</span><br><span class="line"><span class="comment">//        anim.type = CATransitionType(rawValue: "cube")</span></span><br><span class="line"><span class="comment">// 基于运动的过渡方向方向：.fromRight、.fromLeft、.fromTop、.fromBottom</span></span><br><span class="line">anim.subtype = <span class="type">CATransitionSubtype</span>.fromRight</span><br><span class="line"><span class="comment">// 注意：过渡动画一次只能添加一次，并且其key自动设置为 kCATransition</span></span><br><span class="line">redLayer.add(anim, forKey: <span class="literal">nil</span>)</span><br><span class="line">redLayer.backgroundColor = <span class="type">UIColor</span>.blue.cgColor</span><br></pre></td></tr></table></figure>

<p><code>CATransition</code> 的提供的标准动画类型太少了，那么如果我们需要做一些自定义的效果该如何做？做过渡动画基础的原则就是对原始的图层外观截图，然后添加一段动画，平滑过渡到图层改变之后那个截图的效果。如果我们知道如何对图层截图，我们就可以使用属性动画来代替CATransition或者是UIKit的过渡方法来实现动画。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、生成一张屏幕截图</span></span><br><span class="line"><span class="type">UIGraphicsBeginImageContextWithOptions</span>(<span class="keyword">self</span>.view.bounds.size, <span class="literal">true</span>, <span class="number">0.0</span>)</span><br><span class="line">view.layer.render(<span class="keyword">in</span>: <span class="type">UIGraphicsGetCurrentContext</span>()!)</span><br><span class="line"><span class="keyword">let</span> coverImg = <span class="type">UIGraphicsGetImageFromCurrentImageContext</span>()</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 2、把屏幕截图添加到view，作为原始图</span></span><br><span class="line"><span class="keyword">let</span> coverView = <span class="type">UIImageView</span>(image: coverImg)</span><br><span class="line">coverView.frame = view.bounds</span><br><span class="line">view.addSubview(coverView)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 3、修改要过渡到的效果</span></span><br><span class="line"><span class="keyword">let</span> red = <span class="type">CGFloat</span>(arc4random()) / <span class="type">CGFloat</span>(<span class="type">INT_MAX</span>)</span><br><span class="line"><span class="keyword">let</span> green = <span class="type">CGFloat</span>(arc4random()) / <span class="type">CGFloat</span>(<span class="type">INT_MAX</span>)</span><br><span class="line"><span class="keyword">let</span> blue = <span class="type">CGFloat</span>(arc4random()) / <span class="type">CGFloat</span>(<span class="type">INT_MAX</span>)</span><br><span class="line">view.backgroundColor = <span class="type">UIColor</span>(red: red, green: green, blue: blue, alpha: <span class="number">1.0</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 4、对原始图作动画，并显示过渡后的效果</span></span><br><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">3</span>, animations: &#123;</span><br><span class="line">    <span class="keyword">var</span> transform = <span class="type">CGAffineTransform</span>(scaleX: <span class="number">0.01</span>, y: <span class="number">0.01</span>)</span><br><span class="line">    transform = transform.rotated(by: <span class="type">CGFloat</span>.pi/<span class="number">2</span>)</span><br><span class="line">    coverView.transform = transform</span><br><span class="line">    coverView.alpha = <span class="number">0.0</span></span><br><span class="line">    </span><br><span class="line">&#125;) &#123; (res) <span class="keyword">in</span></span><br><span class="line">    coverView.removeFromSuperview()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CAMediaTiming"><a href="#CAMediaTiming" class="headerlink" title="CAMediaTiming"></a>CAMediaTiming</h3><p>动画简单的定义就是指一个值随时间的变化。<code>Core Animation</code> 通过 <code>CAMediaTiming</code>为 <code>CAAnimation</code> 和 <code>CALayer</code> 提供了基本的计时功能，和强大的时间轴功能。<code>CAMediaTiming</code> 协议中定义了一段动画内用于控制逝去时间的属性集合，如：动画的时间间隔、持续时间、速度、重复计数等属性。所以时间可以被任意基于一个图层或者一段动画的类控制。</p>
<p>对于 <code>CAMediaTiming</code> 协议 Apple文档的定义为：CAMediaTiming 为分层计时系统建模，允许对象在其父时间和本地时间之间映射时间。从父时间到本地时间的转换有两个阶段:</p>
<ol>
<li><p>转换为“active local time”。这包括对象在父对象的时间轴上出现的时间点，以及它相对于父对象播放的速度。</p>
</li>
<li><p>从“active local time”到“basic local time”的转换。计时模型允许对象多次重复它们的基本持续时间，并且可以选择在重复之前回放。</p>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">CAMediaTiming</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 指定 接收方 相对于其父对象的开始时间。默认值0</span></span><br><span class="line">    <span class="comment">// 用于设置动画开始之前的的延迟时间</span></span><br><span class="line">    <span class="keyword">var</span> beginTime: <span class="type">CFTimeInterval</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定动画的基本持续时间，以秒为单位，默认值为0</span></span><br><span class="line">    <span class="keyword">var</span> duration: <span class="type">CFTimeInterval</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 指如何将时间从父时间空间映射到接收者的时间空间，默认值 1.0</span></span><br><span class="line"><span class="comment">    * 例如，如果速度为2.0，本地时间的进展速度是父时间的两倍。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">var</span> speed: <span class="type">Float</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 指active local time中的额外偏移量。默认值为 0.0</span></span><br><span class="line"><span class="comment">    * 从 parent time(tp) 转换为 active local time(t):  t = (tp - begin) * speed + offset</span></span><br><span class="line"><span class="comment">    * 它的用途：设置 speed == 0，timeOffset == suitable value 来暂停一个动画</span></span><br><span class="line"><span class="comment">    * tp是父layer的时间点，为了方便理解，可以认为是绝对时间，随时间流逝而增加。</span></span><br><span class="line"><span class="comment">    * begin、speed、offset就是动画的属性beginTime、speed、timeOffset</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">var</span> timeOffset: <span class="type">CFTimeInterval</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 动画重复的迭代次数</span></span><br><span class="line">    <span class="keyword">var</span> repeatCount: <span class="type">Float</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动画重复的秒数，如果和repeatCount同时设置，则无效</span></span><br><span class="line">    <span class="keyword">var</span> repeatDuration: <span class="type">CFTimeInterval</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动画结束后，是否反向播放。默认值为false</span></span><br><span class="line">    <span class="keyword">var</span> autoreverses: <span class="type">Bool</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 填充模式，定义动画在其有效持续时间之外如何显示</span></span><br><span class="line">    <span class="keyword">var</span> fillMode: <span class="type">CAMediaTimingFillMode</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="层级关系时间"><a href="#层级关系时间" class="headerlink" title="层级关系时间"></a>层级关系时间</h4><p>每个动画和图层在时间上都有它自己的层级概念，相对于它的父亲来测量。对图层调整时间将会影响到它本身和子图层的动画，但不会影响到父图层。</p>
<p>CoreAnimation有一个全局时间的概念，通过如下方法获取，其值是根据CPU的时钟周期数来描述的。我们无需知道该函数返回的值，它的值作用在于给动画的时间测量提供一个相对值。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回当前 CoreAnimation 的绝对时间，它是通过调用mach_absolute_time()并将单位转换为秒的结果。</span></span><br><span class="line"><span class="comment">// 其实，开机后设备一共运行了(设备休眠不统计在内)多少秒</span></span><br><span class="line"><span class="type">CACurrentMediaTime</span>()</span><br></pre></td></tr></table></figure>

<p>每个 CALayer 和 CAAnimaion 实例都有自己本地时间的概念，它是根据父图层/动画层级关系中的 beginTime、timeOffset 和 speed 属性计算来的。CALayer提供了如下方法来转换不同图层之间的本地时间：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 将指定层的时间间隔转换为接收方的时间间隔</span></span><br><span class="line"><span class="comment">/// - Parameters:</span></span><br><span class="line"><span class="comment">///   - t: 在l坐标系中指定位置的点</span></span><br><span class="line"><span class="comment">///   - l: 时间空间中有t的那一个l。接收者和l和必须共享一个公共的父层。</span></span><br><span class="line">返回</span><br><span class="line"><span class="comment">/// - Returns: 转换为接收器的时间间隔</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convertTime</span><span class="params">(<span class="number">_</span> t: CFTimeInterval, from l: CALayer?)</span></span> -&gt; <span class="type">CFTimeInterval</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 将时间间隔从接收器的时间空间转换为指定层的时间空间</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convertTime</span><span class="params">(<span class="number">_</span> t: CFTimeInterval, to l: CALayer?)</span></span> -&gt; <span class="type">CFTimeInterval</span></span><br></pre></td></tr></table></figure>

<p>来看看下面例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> layer = <span class="type">CALayer</span>()</span><br><span class="line"><span class="keyword">let</span> offLayer = <span class="type">CALayer</span>()</span><br><span class="line">       </span><br><span class="line">offLayer.timeOffset = <span class="type">CFTimeInterval</span>(<span class="number">1</span>)</span><br><span class="line">offLayer.speed = <span class="number">0.5</span></span><br><span class="line">       </span><br><span class="line"><span class="comment">// 将 layer时间空间的 0.5秒 的时间间隔 转换为 offLayer 时间空间的 1.25</span></span><br><span class="line"><span class="built_in">print</span>(offLayer.convertTime(<span class="type">CFTimeInterval</span>(<span class="number">0.5</span>), from: layer)) <span class="comment">// prints 1.25</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 将 layer 的时间空间里的 0.5秒时间间隔 转换为 offLayer 时间空间的时间间隔 1.25</span></span><br><span class="line"><span class="built_in">print</span>(layer.convertTime(<span class="type">CFTimeInterval</span>(<span class="number">0.5</span>), to: offLayer)) <span class="comment">// prints 1.25</span></span><br></pre></td></tr></table></figure>




<h4 id="例子：动画的暂停、恢复、取消"><a href="#例子：动画的暂停、恢复、取消" class="headerlink" title="例子：动画的暂停、恢复、取消"></a>例子：动画的暂停、恢复、取消</h4><p>这个例子是根据 timeOffset 属性提供的公式来进的，具体讲解可以学习 <a href="https://juejin.im/post/6844903881084780557" target="_blank" rel="noopener">iOS动画暂停与恢复的理解</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t &#x3D; (tp - begin) * speed + offset</span><br><span class="line">tp是父layer的时间点，为了方便理解，可以认为是绝对时间，随时间流逝而增加。</span><br><span class="line"></span><br><span class="line">begin、speed、offset就是动画的属性beginTime、speed、timeOffset。</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开始</span></span><br><span class="line"><span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">startAnim</span><span class="params">()</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> anim = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"position"</span>)</span><br><span class="line">    anim.duration = <span class="number">6.0</span></span><br><span class="line">    anim.fromValue = redLayer.position</span><br><span class="line">    anim.toValue = <span class="type">CGPoint</span>(x: <span class="number">100</span>, y: <span class="number">400</span>)</span><br><span class="line">    redLayer.add(anim, forKey: <span class="string">"key_position"</span>)</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 暂停</span></span><br><span class="line"><span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">pauseAnim</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 获取redLayer的当前本地时间</span></span><br><span class="line">    <span class="keyword">let</span> pausedTime = redLayer.convertTime(<span class="type">CACurrentMediaTime</span>(), from: <span class="literal">nil</span>)</span><br><span class="line">    redLayer.speed = <span class="number">0.0</span></span><br><span class="line">    redLayer.timeOffset = pausedTime</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 恢复</span></span><br><span class="line"><span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">continueAnim</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> pausedTime = redLayer.timeOffset</span><br><span class="line">    redLayer.speed = <span class="number">1.0</span></span><br><span class="line">    redLayer.timeOffset = <span class="number">0.0</span></span><br><span class="line">    redLayer.beginTime = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">let</span> timeSincePause = redLayer.convertTime(<span class="type">CACurrentMediaTime</span>(), from: <span class="literal">nil</span>) - pausedTime</span><br><span class="line">    redLayer.beginTime = timeSincePause</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 取消</span></span><br><span class="line"><span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">removeAnim</span><span class="params">()</span></span> &#123;</span><br><span class="line">    redLayer.removeAnimation(forKey: <span class="string">"key_position"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="例子：控制动画时间"><a href="#例子：控制动画时间" class="headerlink" title="例子：控制动画时间"></a>例子：控制动画时间</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> slider = <span class="type">UISlider</span>(frame: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">250</span>, height: <span class="number">20</span>))</span><br><span class="line">slider.center = view.center</span><br><span class="line">slider.minimumValue = <span class="number">0.0</span></span><br><span class="line">slider.maximumValue = <span class="number">1.0</span></span><br><span class="line">slider.addTarget(<span class="keyword">self</span>, action: #selector(changeColor(<span class="number">_</span> :)), <span class="keyword">for</span>: .valueChanged)</span><br><span class="line">view.addSubview(slider)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> anim = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"backgroundColor"</span>)</span><br><span class="line">anim.fromValue = <span class="type">UIColor</span>.red.cgColor</span><br><span class="line">anim.toValue = <span class="type">UIColor</span>.blue.cgColor</span><br><span class="line">anim.duration = <span class="number">1.0</span></span><br><span class="line">redLayer.add(anim, forKey: <span class="string">"backgroundColor"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 暂停动画</span></span><br><span class="line">redLayer.speed = <span class="number">0.0</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">changeColor</span><span class="params">(<span class="number">_</span> slider: UISlider)</span></span> &#123;</span><br><span class="line">    redLayer.timeOffset = <span class="type">CFTimeInterval</span>(slider.value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="CATransaction-事务"><a href="#CATransaction-事务" class="headerlink" title="CATransaction(事务)"></a>CATransaction(事务)</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">2.0</span>, *)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CATransaction</span> : <span class="title">NSObject</span></span></span><br></pre></td></tr></table></figure>
<p>CATransaction（发音CA [trænˈzækʃn] ） 是 Core Animation 中负责成批的把多个图层树的修改作为一个原子更新到渲染树的机制。图层的动画属性的每一个修改必然是事务的一个部分。</p>
<p>在大多数情况下，我们不需要手动创建 <code>CATransaction</code>，每当我们把 显式动画 或者 隐式动画 添加到图层时，<code>Core Animation</code> 都会自动创建一个隐式事务。我们也可以创建显式事务来更精确地管理动画。</p>
<ul>
<li>隐式事务：当图层树被没有获得事务的线程修改的时候将会自动创建，当线程的运行循环(runloop)执行下次迭代的时候将会自动提交事务。如下改图层的 transform，position、backgroundColor动画属性，依赖隐式事务来确保动画同时一起发生。</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redLayer.transform = <span class="type">CATransform3DScale</span>(redLayer.transform, <span class="number">1.2</span>, <span class="number">1.2</span>, <span class="number">1.0</span>)</span><br><span class="line">redLayer.position = <span class="type">CGPoint</span>(x: redLayer.position.x + <span class="number">10</span>, y: redLayer.position.y + <span class="number">30</span>)</span><br><span class="line"><span class="keyword">let</span> red = <span class="type">CGFloat</span>(arc4random()) / <span class="type">CGFloat</span>(<span class="type">INT_MAX</span>)</span><br><span class="line"><span class="keyword">let</span> green = <span class="type">CGFloat</span>(arc4random()) / <span class="type">CGFloat</span>(<span class="type">INT_MAX</span>)</span><br><span class="line"><span class="keyword">let</span> blue = <span class="type">CGFloat</span>(arc4random()) / <span class="type">CGFloat</span>(<span class="type">INT_MAX</span>)</span><br><span class="line">redLayer.backgroundColor = <span class="type">UIColor</span>(red: red, green: green, blue: blue, alpha: <span class="number">1.0</span>).cgColor</span><br></pre></td></tr></table></figure>

<ul>
<li>显式事务：当修改图层树之前，可以通过给 CATransaction 类发送一个 begin 消息来创建一个显式事务，修改完成之后发送 comit 消息。我们经常通过显示事务作如下操作：</li>
</ul>
<h4 id="暂时禁用图层的行为"><a href="#暂时禁用图层的行为" class="headerlink" title="暂时禁用图层的行为"></a>暂时禁用图层的行为</h4><p>通过 显示事务 暂时禁用图层的行为，使得在事务范围所作的任何更改也不会因此而发生的动画。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CATransaction</span>.begin()</span><br><span class="line"><span class="type">CATransaction</span>.setDisableActions(<span class="literal">false</span>)</span><br><span class="line">redLayer.transform = <span class="type">CATransform3DScale</span>(redLayer.transform, <span class="number">1.2</span>, <span class="number">1.2</span>, <span class="number">1.0</span>)</span><br><span class="line"><span class="type">CATransaction</span>.commit()</span><br></pre></td></tr></table></figure>

<h4 id="重载隐式动画的时间"><a href="#重载隐式动画的时间" class="headerlink" title="重载隐式动画的时间"></a>重载隐式动画的时间</h4><p>由于隐式动画的默认时间为0.25s，我们可以设置显式事务的key-value来作为动画持续时间。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CATransaction</span>.begin()</span><br><span class="line"><span class="type">CATransaction</span>.setAnimationDuration(<span class="number">3</span>)</span><br><span class="line">redLayer.position = <span class="type">CGPoint</span>(x: redLayer.position.x + <span class="number">10</span>, y: redLayer.position.y + <span class="number">30</span>)</span><br><span class="line"><span class="type">CATransaction</span>.commit()</span><br></pre></td></tr></table></figure>

<h4 id="嵌套显式事务"><a href="#嵌套显式事务" class="headerlink" title="嵌套显式事务"></a>嵌套显式事务</h4><p>显示事务可以被嵌套，通过事务嵌套可以 禁用部分动画的行为 或者 在属性被修改的时候产生的动画使用不同的时间。仅当最外层的事务被提交的时候，动画才会发生。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 外层事务</span></span><br><span class="line"><span class="type">CATransaction</span>.begin()</span><br><span class="line"><span class="type">CATransaction</span>.setAnimationDuration(<span class="number">1.0</span>)</span><br><span class="line">redLayer.position = <span class="type">CGPoint</span>(x: <span class="number">200</span>, y: <span class="number">400</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 内层事务</span></span><br><span class="line">    <span class="type">CATransaction</span>.begin()</span><br><span class="line">    <span class="type">CATransaction</span>.setAnimationDuration(<span class="number">3.0</span>)</span><br><span class="line">    redLayer.transform = <span class="type">CATransform3DMakeScale</span>(<span class="number">1.2</span>, <span class="number">1.2</span>, <span class="number">1.0</span>)</span><br><span class="line">    redLayer.opacity = <span class="number">0.1</span></span><br><span class="line">    <span class="type">CATransaction</span>.commit()</span><br><span class="line">    </span><br><span class="line"><span class="type">CATransaction</span>.commit()</span><br></pre></td></tr></table></figure>

<h3 id="同时设置UIView和CALayer更改的动画"><a href="#同时设置UIView和CALayer更改的动画" class="headerlink" title="同时设置UIView和CALayer更改的动画"></a>同时设置UIView和CALayer更改的动画</h3><p>在iOS中，UIView都关联一个CALayer，并且UIView本身就直接从CALayer中派生出其大部分的数据。</p>
<ul>
<li><p>在iOS中可以根据需要自由地混合基于<code>UIView</code>和基于<code>CALayer</code>的动画代码。可以在基于<code>UIView</code>的动画块(<code>block-based animation</code>)的内部或外部应用 基于 <code>CALayer</code> 的动画。</p>
</li>
<li><p>如果改变的是<code>UIView</code>关联的<code>CALayer</code>的动画属性时，<code>CALayer</code>会采用基于<code>UIView</code>的动画块(<code>block-based animation</code>)的动画参数；而当改变的是自己创建的<code>CALayer</code>时，会忽略基于视图的动画块参数。</p>
</li>
<li><p><code>UIView</code> 类默认禁用基于层的动画，但是可以在基于视图的动画块内部内部启用它们。</p>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1.0</span>) &#123;</span><br><span class="line">    <span class="comment">// UIView的layer隐式动画默认被禁用，需要UIView的块动画启用 </span></span><br><span class="line">    <span class="keyword">self</span>.purpleView.layer.opacity = <span class="number">0.0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> anim = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"position"</span>)</span><br><span class="line">    anim.fromValue = <span class="keyword">self</span>.purpleView.layer.position</span><br><span class="line">    anim.toValue = <span class="type">CGPoint</span>(x: <span class="number">200</span>, y: <span class="number">600</span>)</span><br><span class="line">    anim.duration = <span class="number">3.0</span></span><br><span class="line">    <span class="keyword">self</span>.purpleView.layer.add(anim, forKey: <span class="string">"key_positon"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="学习博客"><a href="#学习博客" class="headerlink" title="学习博客"></a>学习博客</h2><p><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/CoreAnimationBasics/CoreAnimationBasics.html#//apple_ref/doc/uid/TP40004514-CH2-SW3" target="_blank" rel="noopener">Core Animation Programming Guide</a></p>
<p><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Animation_Types_Timing/Introduction/Introduction.html#//apple_ref/doc/uid/TP40006668-SW1" target="_blank" rel="noopener">Introduction to Animation Types and Timing Programming Guide</a></p>
<p><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/AdvancedAnimationTricks/AdvancedAnimationTricks.html#//apple_ref/doc/uid/TP40004514-CH8-SW1" target="_blank" rel="noopener">Advanced Animation Tricks</a></p>
<p><a href="https://developer.apple.com/library/archive/navigation/#section=Topics&topic=Graphics%20%26amp%3B%20Animation" target="_blank" rel="noopener">Graphics&amp;Animation</a></p>
<p><a href="https://zsisme.gitbooks.io/ios-/content/index.html" target="_blank" rel="noopener">iOS Core Animation: Advanced Techniques中文译本</a></p>
<p><a href="http://ronnqvi.st/controlling-animation-timing" target="_blank" rel="noopener">Controlling Animation Timing</a></p>
<p><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Animation_Types_Timing/Articles/AnimationTimingTypesOverview.html#//apple_ref/doc/uid/TP40006669-SW1" target="_blank" rel="noopener">Animation Class Roadmap</a></p>
<p><a href="https://www.jianshu.com/p/05a8f4831371" target="_blank" rel="noopener">iOS动画原理–CAMediaTiming</a></p>
<p><a href="https://cainluo.github.io/categories/Core-Animation/" target="_blank" rel="noopener">玩转iOS开发Core Animation</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Czm</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/09/09/Core-Animation%E8%A7%A3%E6%9E%90/">http://yoursite.com/2020/09/09/Core-Animation%E8%A7%A3%E6%9E%90/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">Czm</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/iOS/">iOS</a><a class="post-meta__tags" href="/tags/Core-Animation/">Core Animation</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/09/10/UIView%E8%A7%A3%E6%9E%90/"><i class="fa fa-chevron-left">  </i><span>UIView解析</span></a></div><div class="next-post pull-right"><a href="/2020/09/09/CALayer%E8%A7%A3%E6%9E%90/"><span>CALayer解析</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Czm</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>